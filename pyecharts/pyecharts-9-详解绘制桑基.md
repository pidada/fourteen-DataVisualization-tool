### æœˆæœ«ç®—æ€»è´¦-æ¡‘åŸºå›¾ç»˜åˆ¶

æœ¬æ–‡ä¸­ä»‹ç»çš„æ˜¯å¦‚ä½•åˆ¶ä½œæ¡‘åŸºå›¾ï¼Œä½¿ç”¨çš„å¯è§†åŒ–åº“æ˜¯å¼ºå¤§çš„`Pyecharts(ç‰ˆæœ¬1.7.1ï¼Œç‰ˆæœ¬ä¸€è‡´å¾ˆé‡è¦)`ã€‚æ–‡ç« å°†ä»å¦‚ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œä»‹ç»ï¼š

- ä»€ä¹ˆæ˜¯æ¡‘åŸºå›¾
- 2ä¸ªå®˜ç½‘``demo`
- åŸå§‹æ•°æ®æ•´ç†
- ç»˜å›¾æ•°æ®ç”Ÿæˆ
- æ¡‘åŸºå›¾ç»˜åˆ¶

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl488coghkj30w60u07ln.jpg)

<!--MORE-->

### ä»€ä¹ˆæ˜¯æ¡‘åŸºå›¾

æ¡‘åŸºå›¾ï¼ˆæ¡‘è‘šå›¾ï¼‰ï¼Œä¹Ÿå«æ¡‘åŸºèƒ½é‡åˆ†æµå›¾æˆ–è€…æ¡‘åŸºèƒ½é‡å¹³è¡¡å›¾ï¼Œé‡Œé¢çš„æ¡‘åŸºå…¶å®æ˜¯ä¸€ä¸ªäººåï¼Œå…¨åæ˜¯*é©¬ä¿®Â·äº¨åˆ©Â·è²å°¼äºšæ–¯Â·é‡Œå°”Â·æ¡‘åŸºï¼ˆMatthew Henry Phineas Riall Sankeyï¼‰*ï¼Œæ˜¯ä¸€åçˆ±å°”å…°è£”å·¥ç¨‹å¸ˆï¼Œä¹Ÿæ˜¯è‹±å›½çš‡å®¶é™†å†›å·¥å…µçš„ä¸Šå°‰ã€‚

å‚è€ƒæ–‡çŒ®ï¼šhttps://zhuanlan.zhihu.com/p/127360262

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl47gzh5tcj30c00gmmy4.jpg)

æ—©åœ¨`1898`å¹´çš„æ—¶å€™ï¼Œä»–å°±ä½¿ç”¨è¿™ç§å›¾å½¢æ¥è¡¨ç¤ºè’¸æ±½æœºçš„èƒ½æºæ•ˆç‡ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl47jspv16j30u00vwng6.jpg)

æ¡‘åŸºä¹‹åï¼Œæ¡‘åŸºå›¾é€æ¸æˆä¸ºç§‘å­¦å’Œå·¥ç¨‹é¢†åŸŸï¼Œä»£è¡¨**å¹³è¡¡ã€èƒ½é‡æµã€ç‰©è´¨æµ**çš„æ ‡å‡†æ¨¡å‹ï¼Œåœ¨ä¸€äº›äº§å“çš„ç”Ÿå‘½å‘¨æœŸè¯„ä¼°ä¸­ä¹Ÿå¸¸è¢«ä½¿ç”¨ï¼Œé€šå¸¸åº”ç”¨äº[èƒ½æº](https://baike.baidu.com/item/èƒ½æº/23358)ã€ææ–™æˆåˆ†ã€[é‡‘è](https://baike.baidu.com/item/é‡‘è/860)ç­‰æ•°æ®çš„å¯è§†åŒ–åˆ†æã€‚ä¸»è¦ç‰¹ç‚¹æ˜¯ï¼š

- å›¾å½¢ç”±è¾¹ã€æµé‡å’Œæ”¯ç‚¹ç»„æˆã€‚è¾¹ä»£è¡¨äº†æµåŠ¨çš„æ•°æ®ï¼Œæµé‡ä»£è¡¨äº†æµåŠ¨æ•°æ®çš„å…·ä½“æ•°å€¼ï¼ŒèŠ‚ç‚¹ä»£è¡¨äº†ä¸åŒåˆ†ç±»
- å§‹æœ«ç«¯çš„åˆ†æ”¯å®½åº¦æ€»å’Œç›¸ç­‰ï¼Œå³æ‰€æœ‰ä¸»æ”¯å®½åº¦çš„æ€»å’Œåº”ä¸æ‰€æœ‰åˆ†å‡ºå»çš„åˆ†æ”¯å®½åº¦çš„æ€»å’Œç›¸ç­‰ï¼Œä¿æŒèƒ½é‡çš„å¹³è¡¡ã€‚





### å®˜ç½‘demo

æœ¬æ–‡ä¸­ä½¿ç”¨çš„`Pyecharts`ç‰ˆæœ¬æ˜¯`1.7.1`ï¼Œç‰ˆæœ¬çš„ä¸€è‡´éå¸¸é‡è¦ã€‚

```python
import pyecharts
pyecharts.__version__
```



![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl4mhr8inuj313g07i75m.jpg)

#### demo_1

é¦–å…ˆæˆ‘ä»¬çœ‹çœ‹å®˜ç½‘çš„ç¬¬ä¸€ä¸ª`demo`ï¼š

```python
from pyecharts import options as opts
from pyecharts.charts import Sankey

nodes = [   # æ‰€æœ‰èŠ‚ç‚¹åç§°
    {"name": "category1"},
    {"name": "category2"},
    {"name": "category3"},
    {"name": "category4"},
    {"name": "category5"},
    {"name": "category6"},
]

links = [  # æ¯ä¸€æ¡é“¾è·¯çš„æ•°æ®ï¼ŒåŒ…å«ï¼šçˆ¶èŠ‚ç‚¹source + å­èŠ‚ç‚¹target + æ•°æ®å€¼value
    {"source": "category1", "target": "category2", "value": 10},   
    {"source": "category2", "target": "category3", "value": 15},
    {"source": "category3", "target": "category4", "value": 20},
    {"source": "category5", "target": "category6", "value": 25},
]
c = (
    Sankey()
    .add(
        "sankey",
        nodes,
        links,
        linestyle_opt=opts.LineStyleOpts(opacity=0.2, curve=0.5, color="source"),
        label_opts=opts.LabelOpts(position="right"),
    )
    .set_global_opts(title_opts=opts.TitleOpts(title="Sankey-åŸºæœ¬ç¤ºä¾‹"))
  #  .render("sankey_base.html")    ç”ŸæˆHTMLæ–‡ä»¶
)

c.render_notebook()   # jupyter notebookä¸­åœ¨çº¿æ˜¾ç¤º
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œ`nodes`éƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯æ‰€æœ‰çš„èŠ‚ç‚¹åç§°ï¼Œ**ä¸ç®¡æ˜¯çˆ¶èŠ‚ç‚¹è¿˜æ˜¯æœ€å°çš„å­èŠ‚ç‚¹éƒ½è¦åˆ—å‡ºæ¥**ï¼›`links`éƒ¨åˆ†è¡¨ç¤ºçš„æ˜¯æ¯æ¡é“¾è·¯çš„æ•°æ®ï¼ŒåŒ…å«ï¼š**çˆ¶èŠ‚ç‚¹source + å­èŠ‚ç‚¹target + æ•°æ®å€¼value**ã€‚æ ¹æ®linksçš„æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼š`category1â€”â€”-category2â€”â€”â€”category3â€”â€”â€”category4`æ„æˆäº†ä¸€æ¡å®Œæ•´çš„é“¾è·¯ï¼Œ`category5â€”category6`æ„æˆäº†å¦ä¸€æ¡é“¾è·¯ã€‚

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl323gqsamj30u607ytae.jpg)

ä¸‹é¢æ˜¯æœ€ç»ˆçš„å›¾å½¢ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl324qw015j31ac0t4mz6.jpg)

#### demo_2

æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹å®˜ç½‘çš„ç¬¬äºŒä¸ª`demo`ï¼š

```python
import json

from pyecharts import options as opts
from pyecharts.charts import Sankey

with open("product.json", "r", encoding="utf-8") as f:   # å¯¼å…¥jsonæ•°æ®
    j = json.load(f)    # jsonæ•°æ®è½¬æˆå­—å…¸æ•°æ®
c = (
    Sankey()
    .add(
        "sankey",
        nodes=j["nodes"],   # å–å‡ºjsonæ•°æ®çš„èŠ‚ç‚¹å’Œé“¾è·¯æ•°æ®
        links=j["links"],
        pos_top="10%",
        focus_node_adjacency=True,
        levels=[
            opts.SankeyLevelsOpts(
                depth=0,
                itemstyle_opts=opts.ItemStyleOpts(color="#fbb4ae"),
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
            opts.SankeyLevelsOpts(
                depth=1,
                itemstyle_opts=opts.ItemStyleOpts(color="#b3cde3"),
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
            opts.SankeyLevelsOpts(
                depth=2,
                itemstyle_opts=opts.ItemStyleOpts(color="#ccebc5"),
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
            opts.SankeyLevelsOpts(
                depth=3,
                itemstyle_opts=opts.ItemStyleOpts(color="#decbe4"),
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
        ],
        linestyle_opt=opts.LineStyleOpts(curve=0.5),
    )
    .set_global_opts(
        title_opts=opts.TitleOpts(title="Sankey-Level Settings"),
        tooltip_opts=opts.TooltipOpts(trigger="item", trigger_on="mousemove"),
    )
#    .render("sankey_with_level_setting.html")
)

c.render_notebook()   # åœ¨çº¿æ˜¾ç¤º
```

- è¯»å–æœ¬åœ°çš„`json`æ•°æ®ï¼Œé€šè¿‡`josn.load()`è¯»å–è½¬æˆ`Python`å­—å…¸
- å–å‡º`json`æ•°æ®ä¸­çš„èŠ‚ç‚¹å’Œé“¾è·¯æ•°æ®è¿›è¡Œç»˜å›¾

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl4mxwvmiyj31dm0t2drh.jpg)

### åŸå§‹æ•°æ®æ•´ç†

é€šè¿‡ä¸Šé¢å®˜ç½‘çš„ä¾‹å­æˆ‘ä»¬æ˜ç™½äº†ç»˜åˆ¶æ¡‘åŸºå›¾éœ€è¦çš„ä¸¤ä¸ªæ•°æ®ï¼š**èŠ‚ç‚¹æ•°æ®+é“¾è·¯æ•°æ®**ï¼Œä¸‹é¢ğŸ‘‡é€šè¿‡ä¸€ä¸ªå®é™…çš„æ¡ˆä¾‹æ¥è®²è§£å¦‚ä½•ç”Ÿæˆç»˜åˆ¶æ¡‘åŸºå›¾éœ€è¦çš„æ•°æ®

#### è®¤è¯†åŸå§‹æ•°æ®

PeteråŒå­¦ä¸€ä¸ªäººåœ¨æ·±åœ³æ¬ç –ï¼Œè¾›è¾›è‹¦è‹¦åœ°æ¬äº†ä¸€ä¸ªæœˆï¼Œäº§ç”Ÿå¾ˆå¤šçš„å¼€é”€ğŸ˜­ï¼Œè¿™äº›å¼€æ”¯ä¸»è¦åˆ†æˆ5å¤§å—ï¼š

- ä½å®¿
- é¤é¥®
- äº¤é€š
- æœè£…
- çº¢åŒ…

æ¯ä¸ªéƒ¨åˆ†åˆåˆ†åˆ«æœ‰ä¸åŒçš„å»å‘ï¼Œæ‰€ä»¥è¿™äº›æ•°æ®å°±è‡ªç„¶æ„æˆäº†ä¸€æ¡æ¡çš„é“¾è·¯ï¼Œæ¯”å¦‚ï¼š`æ€»è´¹ç”¨â€”ä½å®¿â€”æˆ¿ç§Ÿï¼ˆ2000ï¼‰`ï¼Œ`æ€»è´¹ç”¨â€”äº¤é€šâ€”æ»´æ»´ï¼ˆ220ï¼‰`ç­‰ï¼Œ**æˆ‘ä»¬åªè€ƒè™‘ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„å…³ç³»**

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl339xoaz3j30nc11yn0z.jpg)



#### åˆ†å±‚çº§æ•´ç†æ•°æ®

1ã€æ¥ä¸‹æ¥æˆ‘ä»¬åˆ†ä¸åŒçš„å±‚çº§æ¥æ•´ç†åŸå§‹æ•°æ®ï¼Œé¦–å…ˆæ˜¯ç¬¬ä¸€å±‚ï¼š**æ€»è´¹ç”¨åˆ°5ä¸ªå­ç‰ˆå—**ã€‚ç®—å‡ºæ¯ä¸ªå­ç‰ˆå—çš„æ€»å’Œ

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl33h6om3uj314a0soq8w.jpg)

2ã€æ•´ç†5ä¸ªå­ç‰ˆå—çš„æ•°æ®

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl33hob1hej30bu0uawi4.jpg)

3ã€æˆ‘ä»¬å°†ä¸Šé¢ä¸¤ä¸ªæ­¥éª¤å¾—åˆ°çš„æ•°æ®æ”¾å…¥ä¸€ä¸ª`sheet`ä¸­ï¼Œå‘½åä¸º`å¼€æ”¯`ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl33j7c8c0j30fk11kwk1.jpg)



### æ¡‘åŸºå›¾æ•°æ®ç”Ÿæˆ

#### è¯»å–æ•°æ®

é¦–å…ˆæˆ‘ä»¬å°†ä¸Šé¢åˆ¶ä½œå¥½çš„**å¼€æ”¯**è¿™ä»½æ•°æ®è¯»åˆ°pandasä¸­ï¼š

```python
import pandas as pd
import numpy as np
import json

# ç­‰ä»·äºï¼šdata = pd.read_excel("life.xlsx",sheet_name=1)  1è¡¨ç¤ºsheet_nameçš„ç´¢å¼•ä½ç½®ï¼Œç´¢å¼•ä»0å¼€å§‹
df = pd.read_excel("life.xlsx",sheet_name="å¼€æ”¯")  # ç›´æ¥å†™åå­—
df.head()
```

æ³¨æ„ä¸¤ç‚¹ï¼š

1. å½“ä¸€ä¸ªè¡¨æ ¼ä¸­å­˜åœ¨å¤šä¸ª`sheet`çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®š`sheet_name`çš„åå­— 
2. æŒ‡å®š`sheet_name`çš„åå­—æœ‰ä¸¤ç§æ–¹å¼ï¼š
   1. ç›´æ¥æŒ‡å®šåå­—
   2. æŒ‡å®šè¯¥`sheet_name`çš„ä½ç½®ç´¢å¼•

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl45hqpksej30ae10i76y.jpg)



#### ç¡®å®šå…¨éƒ¨èŠ‚ç‚¹nodes

1ã€å…ˆæ‰¾å‡ºå…¨éƒ¨çš„èŠ‚ç‚¹

æ‰€æœ‰çš„èŠ‚ç‚¹æ•°æ®å°±æ˜¯ä¸Šé¢çš„**çˆ¶ç±»å’Œå­ç±»ä¸­å»é‡åçš„å…ƒç´ **ï¼Œæˆ‘ä»¬ä½¿ç”¨é›†åˆ`set`è¿›è¡Œå»é‡ï¼Œå†è½¬æˆåˆ—è¡¨

```python
# çˆ¶ç±»+å­ç±»ä¸­çš„æ•°æ®ï¼Œéœ€è¦å»é‡

df['çˆ¶ç±»'].tolist()
df['å­ç±»'].tolist()
```

å°†ä¸Šé¢çš„æ•°æ®ç›¸åŠ å¹¶ä¸”å»é‡ï¼š

```python
# å°†ä¸¤ä¸ªåˆ—è¡¨ç›¸åŠ ï¼Œåœ¨è½¬æˆé›†åˆsetè¿›è¡Œå…ƒç´ å»é‡ï¼Œå†è½¬æˆåˆ—è¡¨

nodes = list(set(df['çˆ¶ç±»'].tolist() + df['å­ç±»'].tolist())) 
nodes
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl45lwo0w3j31140qu0vv.jpg)

2ã€ç”ŸæˆèŠ‚ç‚¹æ•°æ®

```python
# èŠ‚ç‚¹åˆ—è¡¨æ•°æ®: nodes_list

nodes_list = []
for i in nodes:
    dic = {}
    dic["name"] = i
    nodes_list.append(dic)
nodes_list
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl45n5qhkjj30je0o8779.jpg)

#### ç”Ÿæˆé“¾è·¯æ•°æ®

æˆ‘ä»¬å°†å¯¼å…¥çš„æ•°æ®ç”Ÿæˆé“¾è·¯æ•°æ®ï¼šæ¯ä¸€è¡Œè®°å½•éƒ½æ˜¯ä¸€ä¸ªé“¾è·¯æ•°æ®ï¼š

```python
links_list = []

for i in range(len(df)):
    dic = {}
    dic['source'] = df.iloc[i,0]  # çˆ¶ç±»
    dic['target'] = df.iloc[i,1]  # å­ç±»
    dic['value'] = int(df.iloc[i,2])   # æ•°æ®å€¼ : ä½¿ç”¨intå‡½æ•°ç›´æ¥å¼ºåˆ¶è½¬æ¢ï¼Œé˜²æ­¢json.dump()æŠ¥é”™
    links_list.append(dic)
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl45owrkorj30ya0nutfg.jpg)

Attentionâš ï¸ï¼šå¯¼å…¥çš„æ•°æ®éƒ¨åˆ†éœ€è¦å¼ºåˆ¶è½¬æ¢æˆ`int`ç±»å‹ï¼Œé˜²æ­¢åé¢çš„æ•°æ®å¤„ç†æŠ¥é”™ã€‚

åˆ°æ­¤ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ¡‘è‘šå›¾ä¸­**èŠ‚ç‚¹æ•°æ®å’Œé“¾è·¯æ•°æ®**çš„ç”Ÿæˆï¼Œä¸‹é¢å¼€å§‹ç»˜å›¾ã€‚



### ç»˜åˆ¶æ¡‘åŸºå›¾

æˆ‘ä»¬é€šè¿‡å®˜ç½‘çš„2ç§ä¸åŒæ–¹å¼æ¥ç»˜åˆ¶æ¡‘åŸºå›¾

#### æ–¹å¼1

è¿™ç§æ–¹å¼æ¯”è¾ƒç®€å•ï¼šç›´æ¥å°†ä¸Šé¢å¾—åˆ°çš„`nodes_list`å’Œ`links_list`æ•´ä½“æ”¾å…¥ç»˜å›¾çš„ä»£ç ä¸­ï¼š

```python
# éœ€è¦äº‹å…ˆå¯¼å…¥ï¼Œå¦åˆ™jupyter notebookä¸­å¯èƒ½ä¸ä¼šå‡ºå›¾
from pyecharts.globals import CurrentConfig, OnlineHostType
from pyecharts import options as opts  # å›¾å½¢è®¾ç½®
from pyecharts.charts import Sankey    # å¯¼å…¥æ¡‘åŸºå›¾å‹çš„ç±»

nodes_list = [
 {'name': 'å›´å·¾'},
 {'name': 'é•¿è¾ˆ'},
 {'name': 'ç½‘ç»œè´¹'},
 {'name': 'æœè£…'},
 {'name': 'å…¬äº¤'},
 {'name': 'åŒå­¦'},
 {'name': 'è¢œå­'},
 {'name': 'æ€»è´¹ç”¨'},
 {'name': 'è¡£æœ'},
 {'name': 'çº¢åŒ…'},
 {'name': 'äº¤é€š'},
 {'name': 'èšé¤'},
 {'name': 'æ»´æ»´'},
 {'name': 'é¤é¥®'},
 {'name': 'ç®¡ç†è´¹'},
 {'name': 'æ°´ç”µ'},
 {'name': 'å…±äº«å•è½¦'},
 {'name': 'å¤–å–'},
 {'name': 'æˆ¿ç§Ÿ'},
 {'name': 'ä½å®¿'},
 {'name': 'é¥®æ–™'},
 {'name': 'é‹å­'},
 {'name': 'åœ°é“'}
]

links_list = [
 {'source': 'æ€»è´¹ç”¨', 'target': 'ä½å®¿', 'value': 2580},
 {'source': 'æ€»è´¹ç”¨', 'target': 'é¤é¥®', 'value': 1300},
 {'source': 'æ€»è´¹ç”¨', 'target': 'äº¤é€š', 'value': 500},
 {'source': 'æ€»è´¹ç”¨', 'target': 'æœè£…', 'value': 900},
 {'source': 'æ€»è´¹ç”¨', 'target': 'çº¢åŒ…', 'value': 1300},
 {'source': 'ä½å®¿', 'target': 'æˆ¿ç§Ÿ', 'value': 2000},
 {'source': 'ä½å®¿', 'target': 'æ°´ç”µ', 'value': 400},
 {'source': 'ä½å®¿', 'target': 'ç®¡ç†è´¹', 'value': 100},
 {'source': 'ä½å®¿', 'target': 'ç½‘ç»œè´¹', 'value': 80},
 {'source': 'é¤é¥®', 'target': 'å¤–å–', 'value': 800},
 {'source': 'é¤é¥®', 'target': 'èšé¤', 'value': 300},
 {'source': 'é¤é¥®', 'target': 'é¥®æ–™', 'value': 200},
 {'source': 'äº¤é€š', 'target': 'æ»´æ»´', 'value': 220},
 {'source': 'äº¤é€š', 'target': 'åœ°é“', 'value': 150},
 {'source': 'äº¤é€š', 'target': 'å…¬äº¤', 'value': 80},
 {'source': 'äº¤é€š', 'target': 'å…±äº«å•è½¦', 'value': 50},
 {'source': 'æœè£…', 'target': 'è¡£æœ', 'value': 400},
 {'source': 'æœè£…', 'target': 'é‹å­', 'value': 300},
 {'source': 'æœè£…', 'target': 'å›´å·¾', 'value': 150},
 {'source': 'æœè£…', 'target': 'è¢œå­', 'value': 50},
 {'source': 'çº¢åŒ…', 'target': 'åŒå­¦', 'value': 800},
 {'source': 'çº¢åŒ…', 'target': 'é•¿è¾ˆ', 'value': 500}
]

c = (
    Sankey()
    .add(
        "æœˆåº¦å¼€æ”¯",
        nodes_list,
        links_list,
        linestyle_opt=opts.LineStyleOpts(opacity=0.5, curve=0.5, color="source"),
        label_opts=opts.LabelOpts(position="right"),
    )
    .set_global_opts(title_opts=opts.TitleOpts(title="æœˆåº¦å¼€æ”¯æ¡‘è‘šå›¾"))
)

c.render_notebook()
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl46gjrb2bj30u00xhaw5.jpg)

å¾—åˆ°çš„æ¡‘åŸºå›¾åœ¨`notebook`ä¸­æ˜¯åŠ¨æ€çš„å›¾å½¢ï¼š

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl467smyjnj31980s4wiw.jpg)



#### æ–¹å¼2

å¦‚æœæ•°æ®æ¯”è¾ƒå°‘ï¼Œå°†`nodes_list`å’Œ`links_list`æ”¾å…¥ç»˜å›¾çš„ä»£ç ä¸­ä¸ä¼šå æ®è¿‡å¤šçš„ç©ºé—´ï¼›ä½†æ˜¯å¦‚æœæ•°æ®é‡å¤§ï¼Œä¸åŒé“¾è·¯ç§ç±»å¤šï¼Œå…¨éƒ¨æ”¾åœ¨æ•´ä¸ªç»˜å›¾ä»£ç ä¸­ï¼Œå°±ä¼šæ˜¾å¾—æ•´ä¸ªä»£ç å¾ˆè‡ƒè‚¿ã€‚

äºæ˜¯äº§ç”Ÿäº†æ–¹å¼2ï¼šå…ˆå°†ä¸Šé¢å¾—åˆ°çš„`nodes_list`å’Œ`links_list`ç”Ÿæˆä¸€ä¸ª`json`æ–‡ä»¶ï¼Œå†å°†`json`æ–‡ä»¶é€šè¿‡`with`æ–¹æ³•è¯»è¿›æ¥è¿›è¡Œç»˜å›¾ã€‚ä¸‹é¢è®²è§£å¦‚ä½•é€šè¿‡å¾—åˆ°çš„`nodes_list`å’Œ`links_list`æ•°æ®ç”Ÿæˆæˆ‘ä»¬ç»˜å›¾éœ€è¦çš„`json`æ•°æ®ã€‚

`json`æ ¼å¼çš„æ•°æ®ï¼Œåœ¨`python`ä¸­ä»¥å­—ç¬¦ä¸²çš„å½¢å¼å‘ˆç°ï¼Œ**ä¸€å®šè¦ç”¨åŒå¼•å·æ‹¬èµ·æ¥**ã€‚`json`æ¨¡å—ä¸­æä¾›çš„`4`ä¸ªåŠŸèƒ½ï¼š

- `dumps`ï¼š`python`å­—å…¸æ•°æ®ç±»å‹è½¬æˆjsonæ•°æ®ç±»å‹çš„å­—ç¬¦ä¸²
- `dump`ï¼šå­—å…¸æ•°æ®è½¬æˆå­—ç¬¦ä¸²å¹¶ä¸”å­˜å‚¨åœ¨æ–‡ä»¶ä¸­
- `loads`ï¼šæŠŠ`json`å­—ç¬¦ä¸²è½¬æˆå­—å…¸æ•°æ®ç±»å‹
- `load`ï¼šæŠŠæ–‡ä»¶æ‰“å¼€ï¼Œå¹¶ä¸”ä»å­—ç¬¦ä¸²è½¬æ¢æˆå­—å…¸æ•°æ®ç±»å‹

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl4mx9w0pzj319s0lywhm.jpg)

1ã€å…ˆç”Ÿæˆå­—å…¸æ•°æ®

```python
data_dic = {}

data_dic["nodes"] = nodes_list
data_dic["links"] = links_list
```

å¾—åˆ°çš„å­—å…¸`data_dic`æ•°æ®åˆ†ä¸ºèŠ‚ç‚¹æ•°æ®å’Œé“¾è·¯æ•°æ®ï¼Œå…·ä½“å¦‚ä¸‹ï¼š

```python
{'nodes': [{'name': 'å›´å·¾'},   # èŠ‚ç‚¹éƒ¨åˆ†æ•°æ®
  {'name': 'é•¿è¾ˆ'},
  {'name': 'ç½‘ç»œè´¹'},
  {'name': 'æœè£…'},
  {'name': 'å…¬äº¤'},
  {'name': 'åŒå­¦'},
  {'name': 'è¢œå­'},
  {'name': 'æ€»è´¹ç”¨'},
  {'name': 'è¡£æœ'},
  {'name': 'çº¢åŒ…'},
  {'name': 'äº¤é€š'},
  {'name': 'èšé¤'},
  {'name': 'æ»´æ»´'},
  {'name': 'é¤é¥®'},
  {'name': 'ç®¡ç†è´¹'},
  {'name': 'æ°´ç”µ'},
  {'name': 'å…±äº«å•è½¦'},
  {'name': 'å¤–å–'},
  {'name': 'æˆ¿ç§Ÿ'},
  {'name': 'ä½å®¿'},
  {'name': 'é¥®æ–™'},
  {'name': 'é‹å­'},
  {'name': 'åœ°é“'}],
 'links': [{'source': 'æ€»è´¹ç”¨', 'target': 'ä½å®¿', 'value': 2580},  # é“¾è·¯éƒ¨åˆ†æ•°æ®
  {'source': 'æ€»è´¹ç”¨', 'target': 'é¤é¥®', 'value': 1300},
  {'source': 'æ€»è´¹ç”¨', 'target': 'äº¤é€š', 'value': 500},
  {'source': 'æ€»è´¹ç”¨', 'target': 'æœè£…', 'value': 900},
  {'source': 'æ€»è´¹ç”¨', 'target': 'çº¢åŒ…', 'value': 1300},
  {'source': 'ä½å®¿', 'target': 'æˆ¿ç§Ÿ', 'value': 2000},
  {'source': 'ä½å®¿', 'target': 'æ°´ç”µ', 'value': 400},
  {'source': 'ä½å®¿', 'target': 'ç®¡ç†è´¹', 'value': 100},
  {'source': 'ä½å®¿', 'target': 'ç½‘ç»œè´¹', 'value': 80},
  {'source': 'é¤é¥®', 'target': 'å¤–å–', 'value': 800},
  {'source': 'é¤é¥®', 'target': 'èšé¤', 'value': 300},
  {'source': 'é¤é¥®', 'target': 'é¥®æ–™', 'value': 200},
  {'source': 'äº¤é€š', 'target': 'æ»´æ»´', 'value': 220},
  {'source': 'äº¤é€š', 'target': 'åœ°é“', 'value': 150},
  {'source': 'äº¤é€š', 'target': 'å…¬äº¤', 'value': 80},
  {'source': 'äº¤é€š', 'target': 'å…±äº«å•è½¦', 'value': 50},
  {'source': 'æœè£…', 'target': 'è¡£æœ', 'value': 400},
  {'source': 'æœè£…', 'target': 'é‹å­', 'value': 300},
  {'source': 'æœè£…', 'target': 'å›´å·¾', 'value': 150},
  {'source': 'æœè£…', 'target': 'è¢œå­', 'value': 50},
  {'source': 'çº¢åŒ…', 'target': 'åŒå­¦', 'value': 800},
  {'source': 'çº¢åŒ…', 'target': 'é•¿è¾ˆ', 'value': 500}]}
```



2ã€å°†ç”Ÿæˆçš„å­—å…¸æ•°æ®è½¬æˆ`json`æ•°æ®ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°

é€šè¿‡`json.dump`æ–¹æ³•å°†ä¸Šé¢ç”Ÿæˆçš„å­—å…¸ç±»å‹æ•°æ®è½¬æˆ`json`æ•°æ®ï¼Œå¹¶ä¿å­˜åˆ°æœ¬åœ°ï¼š

```python
with open("sankey.json","w",encoding="utf-8") as f:   # æ•°æ®ä¿å­˜åˆ°äº†æœ¬åœ°
    # json.dump(data_dic, f)   å†™å…¥ä¸€è¡Œæ•°æ®
    json.dump(data_dic, f, indent=2, sort_keys=True, ensure_ascii=False)  # å†™å…¥å¤šè¡Œæ•°æ®
```

3ã€è¯»å–`json`æ•°æ®è¿›è¡Œç»˜å›¾

```python
import json

from pyecharts import options as opts
from pyecharts.charts import Sankey

with open("sankey.json", "r", encoding="utf-8") as f:   # 1ã€æ‰“å¼€ä¿å­˜çš„æ–‡ä»¶
    j = json.load(f)   # 2ã€jsonå­—ç¬¦ä¸²è½¬æˆå­—å…¸ç±»å‹æ•°æ®
c = (
    Sankey()
    .add(
        "æœˆåº¦å¼€æ”¯",
        nodes=j["nodes"],   # 3ã€é€šè¿‡é”®å€¼å¯¹çš„æ˜ å°„å…³ç³»æ¥è¯»å–æ•°æ®
        links=j["links"],
        pos_top="20%",
        focus_node_adjacency=True,
        levels=[
            opts.SankeyLevelsOpts(
                depth=0,
#                 itemstyle_opts=opts.ItemStyleOpts(color="#fbb4ae"),  4ã€å±æ€§çš„è®¾ç½®éƒ¨åˆ†
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
            opts.SankeyLevelsOpts(
                depth=1,
#                 itemstyle_opts=opts.ItemStyleOpts(color="#b3cde3"),
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
            opts.SankeyLevelsOpts(
                depth=2,
#                 itemstyle_opts=opts.ItemStyleOpts(color="#ccebc5"),
                linestyle_opts=opts.LineStyleOpts(color="source", opacity=0.6),
            ),
        ],
        linestyle_opt=opts.LineStyleOpts(curve=0.5,color="source",opacity=0.6,type_="dotted"),
        label_opts=opts.LabelOpts(position="right")
    )
    .set_global_opts(
        title_opts=opts.TitleOpts(title="æœˆåº¦å¼€æ”¯æ¡‘è‘šå›¾"),
        tooltip_opts=opts.TooltipOpts(trigger="item", trigger_on="mousemove|click",is_show=True),
    )
)

c.render_notebook()
```

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl477snz4yj314s0u0wti.jpg)

![](https://tva1.sinaimg.cn/large/0081Kckwgy1gl478w9v42j31d20ougpr.jpg)

